"use strict";angular.module("socialwallIiApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("socialwallIiApp").directive("socialItem",function(){return{restrict:"",scope:{type:"="},controller:function(){}}}).controller("MainCtrl",["$scope","$http","$timeout",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.bricks=[],a.loopTime=1e3,a.gifTime=5e3,a.currType="",a.prevType="",a.loopTimeout="",a.gifTimeout="",a.brickHighlight="",a.isPaused=!1,a.highVisible=!1,a.activeBrick=0,a.activeType="random",a.getPhotos=function(){b.get("db/feed.json").success(function(b){"success"===b.result?(a.gifTime=1e3*b.displaytime,a.bricks.push(b.photos),a.getNewPhotos()):(console.log("No photo data"),c(function(){a.getPhotos()},5e3))}).error(function(b,d){console.log(d+" - Could not load photos"),c(function(){a.getPhotos()},5e3)})},a.getNewPhotos=function(){c.cancel(a.gifTimeout),c.cancel(a.loopTimeout),a.highVisible=!1,b.get("db/newFeed.json").success(function(b){a.highVisible=!1,a.loopTimeout=c(function(){"success"===b.result&&(a.gifTime=1e3*b.displaytime,"random"===a.activeType&&(a.activeBrick=a.bricks[0].length-1),a.activeType="sequential",a.bricks=[a.bricks[0].concat(b.photos)]),"sequential"===a.activeType&&a.activeBrick<a.bricks[0].length-1?a.activeBrick++:(a.activeType="random",a.activeBrick=a.getRandomArbitrary(0,a.bricks[0].length-1)),a.swapContent()},a.loopTime)}).error(function(b,d){console.log(d+" - Could not load photos"),c(function(){a.getNewPhotos()},5e3)})},a.swapContent=function(){a.isPaused===!1&&(a.brickHighlight=a.bricks[0][a.activeBrick],a.highVisible=!0,a.gifTimeout=c(function(){a.getNewPhotos()},a.gifTime))},a.pauseLoop=function(){a.isPaused=!0,c.cancel(a.gifTimeout),c.cancel(a.loopTimeout)},a.addNewLoop=function(){c.cancel(a.gifTimeout),c.cancel(a.loopTimeout),a.getNewPhotos()},a.getRandomArbitrary=function(a,b){return Math.round(Math.random()*(b-a)+a)},a.postTime=5e3,a.postLoopTime=1e3,a.postTimeout="",a.postLoopTimeout="",a.minPosts=10,a.currPost=0,a.initRun=!0,a.feedPosts=[],a.getPosts=function(){b({method:"GET",url:"db/socialFeed.json"}).success(function(b){0!==b.length?(a.initRun===!0?(a.feedPosts.push(b),a.currType=b[0].type,a.postTime=1e3*b[0].displaytime,a.initRun=!1,"video"===a.currType&&a.playVideo()):a.feedPosts=[a.feedPosts[0].concat(b)],a.shiftPost()):(console.log("No post data"),c(function(){a.getPosts()},5e3))}).error(function(b,d){console.log(d+" - Could not load posts"),c(function(){a.getPosts()},5e3)})},a.shiftPost=function(){"socialpost"===a.currType?a.postLoopTimeout=c(function(){angular.element("#social0 .social-inner").slideUp(a.postLoopTime,function(){a.postTimeout=c(function(){a.nextPost()},a.postTime)})},a.postLoopTime):"montage"===a.currType?a.postLoopTimeout=c(function(){angular.element("#montage-master .social-inner").animate({opacity:1},a.postLoopTime,function(){a.postTimeout=c(function(){angular.element("#montage-master .social-inner").animate({opacity:0},a.postLoopTime,function(){a.nextPost()})},a.postTime)})},a.postLoopTime):a.postLoopTimeout=c(function(){angular.element("#social0 .social-inner").animate({opacity:1},a.postLoopTime,function(){a.postTimeout=c(function(){angular.element("#social0 .social-inner").animate({opacity:0},a.postLoopTime,function(){a.nextPost()})},a.postTime)})},a.postLoopTime)},a.playVideo=function(){a.pauseLoop(),c(function(){angular.element("#socialVideo0").get(0).play()},a.postLoopTime)},a.nextPost=function(){a.feedPosts[0].shift(),a.$apply(),a.prevType=a.currType,a.currType=a.findCurrType(),a.postTime=1e3*a.feedPosts[0][0].displaytime,angular.element("#social0 .social-inner").css({display:"inline-block"}),"video"===a.prevType&&"video"!==a.currType&&(a.isPaused=!1,a.swapContent()),"video"===a.currType&&a.playVideo(),a.feedPosts[0].length<a.minPosts?a.getPosts():a.shiftPost()},a.findCurrType=function(){var a=angular.element("#social0 .social-inner").attr("class"),b=a.indexOf("montage"),c=a.indexOf("video");return-1!==b?"montage":-1!==c?"video":"socialpost"}}]);